<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="../CSS/IndexMain.css">
    <!--    引入jQuery-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script>if (typeof module === 'object') {window.jQuery = window.$ = module.exports;};</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/FileSaver.js/2014-11-29/FileSaver.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.0.2/dist/echarts.min.js"></script>
    <title>基于AIOT的输变电工程监管平台</title>
    <link rel="stylesheet" href="../exceltest/index.css">
    <style>
        #myChart{
            display:inline-block;
            width:800px;height:400px;
            /*border:1px solid lightgray;*/
            /*border-right:none;*/
            vertical-align:middle;
            margin-left: 50px;
        }
        .container{
            display:inline-block;
            width:80px;height:200px;
            /*border:1px solid lightgray;*/
            border-left:none;
            margin:-5px;
            vertical-align:middle;

        }
        .buttons{
            display:table-cell;
            width:inherit;height: inherit;
            vertical-align: middle;
        }
        .button{
            font-size:0.75em;
            padding:.3em;
            background-color:rgba(0,0,255,.5);
            border:1px solid transparent;
            border-radius:.5em;
            box-shadow:1px 1px 1px black;
            text-align:center;
            margin:1em;
        }
        .button:hover{
            cursor:pointer;
            background-color:rgba(0,0,255,1);
            color:white;
        }
        .disabled{
            background-color:lightgray;
            color:lavender;
            box-shadow:1px 1px 1px lightslategray;
        }
        .disabled:hover{
            cursor:not-allowed;
            background-color:lightgray;
            color:lavender;
        }

    </style>
</head>
<body >
    <!--导航栏-->
    <nav class="navbar navbar-default">
        <div class="container-fluid" id="top">
            <!-- 导航栏左侧 -->
            <div class="navbar-header" id="logo">
                <a class="navbar-brand" href="IndexMain.html" style="color: white;font-size: 25px;">输变电工程施工安全管理系统</a>
            </div>
            <!-- 导航栏右侧-->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <!--            <ul class="nav navbar-nav">-->
                <!--                <li><a href="#">Link <span class="sr-only">(current)</span></a></li>-->
                <!--                <li><a href="#">Link</a></li>-->
                <!--            </ul>-->
                <span id="cg">2020/03/10 上午12:00:00</span>
                <ul class="nav navbar-nav navbar-right">
                    <li><button id="linkTest" type="button" class="btn btn-primary btn-xs" style="margin-top: 20px;margin-right: 45px">测试连接</button></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li style="margin-top: 9px"><a href="Index.html" >退出登录</a></li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div>
    </nav>
    <!--菜单栏-->
    <div class="col-sm-2" id="menu">
        <!--    <div class="logo">-->
        <!--        <a href="" style="text-decoration: none ;color: black">智慧工地</a>-->
        <!--        <hr>-->
        <!--    </div>-->
        <ul class="nav nav-pills nav-stacked " style="text-align: center">

            <li role="presentation" ><a href="demo03.html"><span class="glyphicon glyphicon-camera" style="color: black;margin-right: 5px"></span>视频监控</a></li>
            <li role="presentation"><a href="Health.html"><span class="glyphicon glyphicon-tint" style="color: black;margin-right: 5px"></span>安全监测</a></li>
            <li role="presentation" class="active"><a href="AiriHealth.html"><span class="glyphicon glyphicon-th-list" style="color: black;margin-right: 5px"></span>水土保持</a></li>
            <li role="presentation" ><a href="DangerForecas.html"><span class="glyphicon glyphicon-bell" style="color: black;margin-right: 5px"></span>风险评估</a></li>
            <li role="presentation"><a href="PersonManage.html"><span class="glyphicon glyphicon-user" style="color: black;margin-right: 5px" ></span>人员管理</a></li>
            <li role="presentation"  ><a href="IndexMain.html"><span class="glyphicon glyphicon-cog" style="color: black;margin-right: 5px;"></span>项目管理</a></li>
            <li role="presentation" ><a href="Location.html"><span class="glyphicon glyphicon-search" style="color: black;margin-right: 5px"></span>电子地图</a></li>
        </ul>
    </div>
    <!--面板-->
    <div class="col-sm-9" >
        <div class="panel panel-default" id="penal">
            <div class="panel-body" >
                <div style="margin-top: 1px">
                    <h4 >工程序号 : <span id="deviceID" class="badge badge-first">D1001</span><button id="getData" type="button" class="btn btn-success btn-primary btn-xs" style="margin-left: 10px">获取数据</button></h4>
                </div>
                <div  class="col-sm-5 panel panel-default" style="width:900px;height: 80px;margin-left: 25px">
                    <div style="float: left;padding-top: 10px">
                        <h3 class="panel-title" style="font-weight: bold;text-align: center">空气温度℃<p id="wd" class="label label-primary">15</p></h3>
                    </div>
                    <div style="float: left;margin-left: 35px;padding-top: 10px">
                        <h3 class="panel-title" style="font-weight: bold;text-align: center">空气湿度℃<p id="sd" class="label label-primary">10</p></h3>
                    </div>
                    <div style="float: left;margin-left: 35px;padding-top: 10px">
                        <h3 class="panel-title" style="font-weight: bold;text-align: center">土壤水分°<p id="sf" class="label label-primary">10</p></h3>
                    </div>
                    <div style="float: left;margin-left: 35px;padding-top: 10px">
                        <h3 class="panel-title" style="font-weight: bold;text-align: center">风速m/s<p id="fs" class="label label-primary">10</p></h3>
                    </div>
                    <div style="float: left;margin-left: 35px;padding-top: 10px">
                        <h3 class="panel-title" style="font-weight: bold;text-align: center">风向<p id="fx" class="label label-primary">东北风</p></h3>
                    </div>
                    <div style="float: left;margin-left: 35px;padding-top: 10px">
                        <h3 class="panel-title" style="font-weight: bold;text-align: center">降雨等级<p id="yl" class="label label-primary">10</p></h3>
                    </div>
                    <div style="margin-top: 45px">
                    <span id="span1" style="margin-top: 440px;margin-left: 270px;font-size: 15px;" class="label label-default">紧急求助</span>
                    <span id="span2" style="margin-top: 440px;margin-left: 145px;font-size: 15px;"class="label label-default">维护检修</span>
                    </div>
                </div>
            <!--数据动态可视化 -->
                <div id="myChart"></div>
                <div class="container">
                    <div class="buttons">
                        <div class="button" id="start">开始</div>
                        <div class="button" id="end"> 结束</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        setInterval("cg.innerHTML=new Date().toLocaleString()",1000);
        const date=[];
        const date2=[];
        window.onload = function (){
            var querystring = require('querystring');
            var wd = document.querySelector("#wd");
            var sd = document.querySelector("#sd");
            var sf = document.querySelector("#sf");
            var fs = document.querySelector("#fs");
            var fx = document.querySelector("#fx");
            var yl = document.querySelector("#yl");
            var span1 = document.querySelector("#span1");
            var span2 = document.querySelector("#span2");
            //建立Socket常连接
                $(document).ready(function () {
                    let namespace = '/air'
                    let socket = io.connect('ws://120.26.66.201:11331' + namespace);
                    socket.emit('ToServer', {data: 'I\'m connected!'})
                    socket.on('ToDevice', function (res) {
                        var data = JSON.stringify(res, null, 4);
                        var datas = JSON.parse(data);
                        var datass = datas.data;
                        console.log(datass)
                        var data2 = [];
                        for (let i in datass) {
                            var a = datass[i];
                            data2.push(a);
                        }
                        console.log(data2)

                        date.push(data2[4]);
                        date2.push(data2[10]*10);
                        //console.log(data2[0])

                        //空气温度
                        wd.innerHTML = data2[4];
                        if (data2[4] == undefined) {
                            wd.innerHTML = 23;
                        }
                        //空气湿度
                        sd.innerHTML = data2[1];
                        if (data2[1] == undefined) {
                            sd.innerHTML = 42;
                        }
                        //土壤水分
                        sf.innerHTML = data2[3];
                        if (data2[3] == undefined) {
                            sf.innerHTML = 40;
                        }
                        //风速
                        var a = Math.sqrt(data2[5]*data2[5]+data2[6]*data2[6]+data2[7]+data2[7])/100;
                        a = a.toFixed(2);
                        fs.innerHTML = a;
                        //风向
                        if(data2[5]<0){
                            fx.innerHTML = "东风"
                        }
                        if(data2[6]<0){
                            fx.innerHTML = "西风"
                        }
                        if(data2[7]<0){
                            fx.innerHTML = "南风"
                        }
                        //雨量
                        yl.innerHTML = data2[10];
                        if (data2[10] == undefined) {
                            yl.innerHTML = 1.25;
                        }

                        //紧急求助
                        if(data2[9]==1){
                            span1.style.color="red";
                            var audio;
                            audio = "../Resource/1.mp3";
                            audio = new Audio(audio);
                            audio.play();
                            span1.onclick = function () {
                                document.querySelector("#span1").style.color = "black";
                                audio.pause();
                            }
                        }
                        //维护检修
                        if(data2[8]==1){
                            span2.style.color="red";
                            var audio;
                            audio ="../Resource/2.mp3";
                            audio = new Audio(audio);
                            audio.play();
                            span2.onclick = function () {
                                document.querySelector("#span2").style.color = "black";
                                audio.pause();
                            }
                        }

                    })
                });

        }
    </script>
</body>
<script src="../exceltest/MyButton.js"></script>
<script src="../exceltest/MyChart.js"></script>
<script src="../exceltest/index.js"></script>
<script src="../Controler/ToJSON.js"></script>
</html>
